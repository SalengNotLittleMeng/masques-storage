(function(a,r){typeof exports=="object"&&typeof module<"u"?module.exports=r():typeof define=="function"&&define.amd?define(r):(a=typeof globalThis<"u"?globalThis:a||self,a.MasquesStorage=r())})(this,function(){"use strict";function a(i){if(typeof i=="string")try{return JSON.parse(i)}catch{}return i}class r{constructor(e={}){this.storageHandler=this.creatStorageHandler(e)}creatStorageHandler(e){return e.handler}get(e,t=!1){if(t)return this.storageHandler.get(e);const s=a(this.storageHandler.get(e));return console.log(s),this.handlerGetMethods?handlerGetMethods(s):s&&s.value}set(e,t=!1){Object.keys(e).forEach(s=>{if(t){this.storageHandler.set(s,JSON.stringify(e[s]));return}const c=Object.create({});c.value=e[s],this.handlerSetMethods&&this.handlerSetMethods(c),this.storageHandler.set(s,JSON.stringify(c))})}delete(e){this.storageHandler.delete(e)}}class n extends r{constructor(){super()}creatStorageHandler(){return{get:sessionStorage.getItem,set:sessionStorage.setItem,delete:sessionStorage.removeItem}}}class h extends r{constructor(){super()}creatStorageHandler(){return{get(e){return localStorage.getItem(e)},set(e,t){localStorage.setItem(e,t)},delete(e){localStorage.removeItem(e)}}}}class o{constructor(e){this.options=e,this.cacheName=this.options.cacheName||"__masque_cache__",this.cacheList=[],this.MapCache=null,this.initCache(),this.flush=!0,this.bufferIndex=0,this.timer=null}initCache(){const e=this.options.init();if(!e){this.cacheList=[],this.MapCache=new Map;return}this.cacheList=e,this.MapCache=new Map(this.cacheList.map(t=>[t.key,t.value]))}add(e,t){try{const s=this.getCacheObject(e,t);this.cacheList.unshift(s),this.MapCache.set(e,t),this.bufferIndex++,this.eventBuffer()}catch{}}eventBuffer(){if(this.bufferIndex>this.options.buffer){this.checkMemery(),this.bufferIndex=0;return}this.options.needSetTimeout&&(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.bufferIndex=0,this.checkMemery()},3e3))}find(e){try{const t=this.MapCache.get(e);return t?(this.cacheList.splice(this.cacheList.findIndex(s=>s.city==city),1),this.cacheList.unshift(this.getCacheObject(e,t)),t):!1}catch{return!1}}getCacheObject(e,t){return{key:e,value:t}}cacheStorage(){this.options.cacheStorage(this.cacheList)}clearCache(){let e=Math.floor(this.cacheList.length/3)*2;for(;e;)this.MapCache.delete(this.cacheList.pop().city),e--}checkMemery(){this.cacheList.length>this.options.size?this.clearCache():this.cacheStorage()}}function u(i,e){switch(i){case"session":return new n(e);case"local":return new h(e);case"cache":return new o(e);default:return new h(e)}}return u});
//# sourceMappingURL=masquesStorage.umd.cjs.map
