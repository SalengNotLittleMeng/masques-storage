(function(a,i){typeof exports=="object"&&typeof module<"u"?module.exports=i():typeof define=="function"&&define.amd?define(i):(a=typeof globalThis<"u"?globalThis:a||self,a.MasquesStorage=i())})(this,function(){"use strict";function a(r){if(typeof r=="string")try{return JSON.parse(r)}catch{}return r}class i{constructor(e={}){this.storageHandler=this.creatStorageHandler(e)}creatStorageHandler(e){return e.handler}get(e,t=!1){if(t)return this.storageHandler.get(e);const s=a(this.storageHandler.get(e));return this.handlerGetMethods?this.handlerGetMethods(s,e):s&&s.value}set(e,t={}){Object.keys(e).forEach(s=>{if(t.isRow){this.storageHandler.set(s,JSON.stringify(e[s]));return}const h=Object.create({});h.value=e[s],this.handlerSetMethods&&this.handlerSetMethods(h,t),this.storageHandler.set(s,JSON.stringify(h))})}delete(e){this.storageHandler.delete(e)}has(e){return this.storageHandler.has(e)}clear(){this.storageHandler.clear()}}class c extends i{constructor(){super()}creatStorageHandler(){return{get(e){return sessionStorage.getItem(e)},set(e,t){sessionStorage.setItem(e,t)},delete(e){sessionStorage.removeItem(e)},has(e){return sessionStorage.has(e)},clear(){sessionStorage.clear()}}}}function o(r,e){e.timeout?r.timeout=new Date().getTime()+(e.timeout||0):r.timeout=-1}function u(r){const{timeout:e}=r;return e==-1?!1:new Date().getTime()>e}class n extends i{constructor(){super()}creatStorageHandler(){return{get(e){return localStorage.getItem(e)},set(e,t){localStorage.setItem(e,t)},delete(e){localStorage.removeItem(e)},has(e){return localStorage.has(e)},clear(){localStorage.clear()}}}handlerSetMethods(e,t){o(e,t)}handlerGetMethods(e,t){const s=e.value;return u(e)&&this.storageHandler.delete(t),s}}class l{constructor(e){this.options=e,this.cacheName=this.options.cacheName||"__masque_cache__",this.cacheList=[],this.MapCache=null,this.initCache(),this.flush=!0,this.bufferIndex=0,this.timer=null}initCache(){const e=this.options.init();if(!e){this.cacheList=[],this.MapCache=new Map;return}this.cacheList=e,this.MapCache=new Map(this.cacheList.map(t=>[t.key,t.value]))}add(e,t){try{const s=this.getCacheObject(e,t);this.cacheList.unshift(s),this.MapCache.set(e,t),this.bufferIndex++,this.eventBuffer()}catch{}}eventBuffer(){if(this.bufferIndex>this.options.buffer){this.checkMemery(),this.bufferIndex=0;return}this.options.needSetTimeout&&(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.bufferIndex=0,this.checkMemery()},3e3))}find(e){try{const t=this.MapCache.get(e);return t?(this.cacheList.splice(this.cacheList.findIndex(s=>s.city==city),1),this.cacheList.unshift(this.getCacheObject(e,t)),t):!1}catch{return!1}}getCacheObject(e,t){return{key:e,value:t}}cacheStorage(){this.options.cacheStorage(this.cacheList)}clearCache(){let e=Math.floor(this.cacheList.length/3)*2;for(;e;)this.MapCache.delete(this.cacheList.pop().city),e--}checkMemery(){this.cacheList.length>this.options.size?this.clearCache():this.cacheStorage()}}function f(r,e){switch(r){case"session":return new c(e);case"local":return new n(e);case"cache":return new l(e);default:return new n(e)}}return f});
//# sourceMappingURL=masquesStorage.umd.cjs.map
